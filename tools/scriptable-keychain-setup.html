<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scriptable Keychain Setup Script | Canvas on Tap</title>
  <link rel="stylesheet" href="/css/canvas-on-tap.css" />
</head>

<body>

  <header>
      <!-- Nav -->
  <div style="background: var(--offwhite); border-bottom: 1px solid #d0d0c0;">
    <div style="max-width: 900px; margin: 0 auto; padding: 0.9rem 1rem; display: flex; align-items: center; justify-content: space-between; gap: 1rem;">
      <a href="/" style="display:flex; align-items:center; gap:0.6rem; text-decoration:none;">
        <span style="font-weight: 800; letter-spacing: 0.4px;">Canvas on Tap</span>
      </a>

      <nav style="display:flex; gap: 1rem; flex-wrap: wrap; justify-content: flex-end;">
        <a href="/blog/" style="text-decoration:none;">Blog</a>
        <a href="/tools/" style="text-decoration:none;">Tools</a>
        <a href="/about/" style="text-decoration:none;">About</a>
        <a href="https://www.youtube.com/@canvasontap" target="_blank" rel="noopener noreferrer" style="text-decoration:none;">YouTube</a>
      </nav>
    </div>
  </div>
    <h1>Scriptable Keychain Setup Script</h1>
    <p>A simple helper for saving secrets securely in Scriptable</p>
    <a class="button" href="#script">Jump to Script</a>
    <a class="button" href="#next">Next Step</a>
  </header>

  <main>
    <article>
      <h2 id="how">How it works</h2>
      <p>
        This Scriptable helper prompts you for a <strong>Key Name</strong> and a <strong>Secret Value</strong>,
        then stores the value securely using Scriptable’s <strong>Keychain</strong>.
        It’s perfect for Canvas API workflows where you don’t want tokens hardcoded into your scripts.
      </p>

      <div class="callout">
        <p><strong>Security note:</strong> This script does <em>not</em> print your secret value to the console.</p>
      </div>

      <h2>Recommended key names</h2>
      <ul>
        <li><strong>BASE_URL</strong> — Your Canvas base URL</li>
        <li><strong>API_TOKEN</strong> — Your Canvas API token</li>
      </ul>

      <hr />

      <h2 id="script">Copy + paste script</h2>
      <p>
        Click the button to copy the entire script. Then paste it into Scriptable and run it once to save your values.
      </p>

      <div style="display:flex; align-items:center; justify-content:space-between; gap:1rem; flex-wrap:wrap;">
        <p id="copyStatus" style="margin:0; font-weight:600;"></p>

        <button
          id="copyBtn"
          type="button"
          style="
            display:inline-block;
            padding:0.75rem 1.5rem;
            background-color: var(--gold);
            color: var(--green);
            font-weight: bold;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
          "
        >
          Copy Script
        </button>
      </div>

      <pre><code id="scriptBlock">// ------------------------------------------------------------
// Scriptable Keychain Helper
// Canvas on Tap Freebie Script
// ------------------------------------------------------------
// This script prompts the user for a Keychain key name and value,
// then securely stores the value using Scriptable's Keychain API.
//
// Example use cases:
// - Storing an API token
// - Saving a Canvas API URL
// - Saving a personal access key
//
// Notes:
// - Keychain values are stored securely on the device.
// - If the key already exists, this script will overwrite it.
// ------------------------------------------------------------

const keychainAlert = new Alert();
keychainAlert.title = "Save Keychain Secret";
keychainAlert.message =
  "Enter a key name and a secret value to store securely in Scriptable's Keychain.";

// Input fields
keychainAlert.addTextField("Key Name (example: API_TOKEN)", "");
keychainAlert.addTextField("Secret Value (example: 123abc...)", "");

// Buttons
keychainAlert.addAction("Save Secret");
keychainAlert.addCancelAction("Cancel");

// Show alert
const buttonIndex = await keychainAlert.present();

// If user cancels, Scriptable returns -1
if (buttonIndex === -1) {
  console.log("Cancelled. No Keychain value was saved.");
  Script.complete();
}

// Get user input
const secretKeyName = keychainAlert.textFieldValue(0).trim();
const secretValue = keychainAlert.textFieldValue(1).trim();

// Validate input
if (!secretKeyName || !secretValue) {
  console.log("Error: Both the key name and secret value are required.");
  Script.complete();
}

// Save to Scriptable Keychain
Keychain.set(secretKeyName, secretValue);

// Confirmation output (DO NOT print secretValue for security)
console.log("Saved Keychain value successfully.");
console.log(`Key Name: ${secretKeyName}`);
</code></pre>

      <hr />

      <h2 id="next">Next step: use your saved secret</h2>
      <p>
        Once you’ve saved a value (example: <code>canvasApiToken</code>), you can retrieve it in any script like this:
      </p>

      <pre><code>const token = Keychain.get("canvasApiToken");
// Use token in your request headers</code></pre>

      <div class="callout">
        <p>
          If you’re building a reusable <strong>makeRequest</strong> helper, pull your token once at the top of the script
          and reuse it across calls.
        </p>
      </div>
    </article>
  </main>

  <footer>
    © Canvas on Tap — Free tools for Scriptable + Canvas API workflows
  </footer>

  <script>
    const copyBtn = document.getElementById("copyBtn");
    const scriptBlock = document.getElementById("scriptBlock");
    const copyStatus = document.getElementById("copyStatus");

    function setStatus(message, isError = false) {
      copyStatus.textContent = message;
      copyStatus.style.color = isError ? "#8b0000" : "inherit";
      window.clearTimeout(copyStatus._t);
      copyStatus._t = window.setTimeout(() => {
        copyStatus.textContent = "";
        copyStatus.style.color = "inherit";
      }, 2500);
    }

    copyBtn.addEventListener("mouseenter", () => {
      copyBtn.style.backgroundColor = "#b3974f";
    });
    copyBtn.addEventListener("mouseleave", () => {
      copyBtn.style.backgroundColor = "var(--gold)";
      copyBtn.style.transform = "translateY(0)";
    });
    copyBtn.addEventListener("mousedown", () => {
      copyBtn.style.transform = "translateY(-1px)";
    });
    copyBtn.addEventListener("mouseup", () => {
      copyBtn.style.transform = "translateY(0)";
    });

    copyBtn.addEventListener("click", async () => {
      const scriptText = scriptBlock.innerText;

      try {
        await navigator.clipboard.writeText(scriptText);
        setStatus("✅ Script copied to clipboard!");
      } catch (err) {
        // Fallback if Clipboard API is blocked
        try {
          const textarea = document.createElement("textarea");
          textarea.value = scriptText;
          textarea.setAttribute("readonly", "");
          textarea.style.position = "absolute";
          textarea.style.left = "-9999px";
          document.body.appendChild(textarea);
          textarea.select();
          document.execCommand("copy");
          document.body.removeChild(textarea);
          setStatus("✅ Script copied to clipboard!");
        } catch (e2) {
          setStatus("❌ Unable to copy. Select the code and copy manually.", true);
        }
      }
    });
  </script>
</body>
</html>
